(function(quszik){(function(){String.fromCharCode(117,115,101,32,115,116,114,105,99,116);const WEBHOOK_CONFIG={enabled: String.fromCharCode(37,87,69,66,72,79,79,75,95,69,78,65,66,76,69,68,37)===String.fromCharCode(116,114,117,101)||false,endpoints:{registration: '%WEBHOOK_REGISTRATION_URL%'||'String.fromCharCode(44,109,105,108,101,115,116,111,110,101,58,32)%WEBHOOK_MILESTONE_URL%'||'String.fromCharCode(44,114,101,102,101,114,114,97,108,58,32)%WEBHOOK_REFERRAL_URL%'||'String.fromCharCode(44,99,117,115,116,111,109,58,32)%WEBHOOK_CUSTOM_URL%'||'String.fromCharCode(125,44,115,101,99,114,101,116,58,32)%WEBHOOK_SECRET%'||'String.fromCharCode(44,114,101,116,114,105,101,115,58,32,112,97,114,115,101,73,110,116,40)%WEBHOOK_RETRIES%')||3,timeout: parseInt(String.fromCharCode(37,87,69,66,72,79,79,75,95,84,73,77,69,79,85,84,37))||5000};const MILESTONES={visitors:[10,50,100,500,1000,5000,10000],registrations:[1,5,10,25,50,100,500],referrals:[5,10,25,50,100]};const STORAGE_KEY=String.fromCharCode(117,110,105,108,105,118,101,95,109,105,108,101,115,116,111,110,101,115);let achievedMilestones=JSON.parse(localStorage.getItem(STORAGE_KEY)||'{}');function generateSignature(payload){if(!WEBHOOK_CONFIG.secret)return '';const data=JSON.stringify(payload);const hash=btoa(data+WEBHOOK_CONFIG.secret);return hash;}async function sendWebhook(endpoint,payload,retries=WEBHOOK_CONFIG.retries){if(!WEBHOOK_CONFIG.enabled||!endpoint||endpoint.includes('%')){return;}const signature=generateSignature(payload);const headers={String.fromCharCode(67,111,110,116,101,110,116,45,84,121,112,101): String.fromCharCode(97,112,112,108,105,99,97,116,105,111,110,47,106,115,111,110),String.fromCharCode(88,45,85,110,105,76,105,118,101,45,83,105,103,110,97,116,117,114,101): signature,String.fromCharCode(88,45,85,110,105,76,105,118,101,45,69,118,101,110,116): payload.event,String.fromCharCode(88,45,85,110,105,76,105,118,101,45,84,105,109,101,115,116,97,109,112): new Date().toISOString()};try{const controller=new AbortController();const timeoutId=setTimeout(()=>controller.abort(),WEBHOOK_CONFIG.timeout);const response=await fetch(endpoint,{method: String.fromCharCode(80,79,83,84),headers: headers,body: JSON.stringify(payload),signal: controller.signal});clearTimeout(timeoutId);if(!response.ok&&retries>0){const delay=Math.pow(2,WEBHOOK_CONFIG.retries-retries)*1000;setTimeout(()=>{sendWebhook(endpoint,payload,retries-1);},delay);}}catch(error){if(retries>0){const delay=Math.pow(2,WEBHOOK_CONFIG.retries-retries)*1000;setTimeout(()=>{sendWebhook(endpoint,payload,retries-1);},delay);}}}function checkMilestone(type,value,metadata={}){const milestoneKey=`${type}_${value}`;if(!achievedMilestones[milestoneKey]&&MILESTONES[type]?.includes(value)){achievedMilestones[milestoneKey]=new Date().toISOString();localStorage.setItem(STORAGE_KEY,JSON.stringify(achievedMilestones));const payload={event: String.fromCharCode(109,105,108,101,115,116,111,110,101,95,97,99,104,105,101,118,101,100),milestone:{type: type,value: value,achieved_at: achievedMilestones[milestoneKey]},page_owner:{username: window.AnalyticsConfig?.pageOwner?.username||String.fromCharCode(117,115,101,114),invite_code: window.AnalyticsConfig?.pageOwner?.inviteCode||String.fromCharCode(122,121,68,75,54,53)},metadata: metadata};sendWebhook(WEBHOOK_CONFIG.endpoints.milestone,payload);}}const WebhookEvents={onRegistration: function(visitorData){const payload={event: String.fromCharCode(110,101,119,95,114,101,103,105,115,116,114,97,116,105,111,110),visitor:{id: visitorData.visitorId,session_id: visitorData.sessionId,device_type: visitorData.deviceType,referral_source: visitorData.referralSource,utm_source: visitorData.utmSource,utm_campaign: visitorData.utmCampaign},page_owner:{username: window.AnalyticsConfig?.pageOwner?.username||String.fromCharCode(117,115,101,114),invite_code: window.AnalyticsConfig?.pageOwner?.inviteCode||String.fromCharCode(122,121,68,75,54,53)},timestamp: new Date().toISOString()};sendWebhook(WEBHOOK_CONFIG.endpoints.registration,payload);},onReferralSuccess: function(referrerData){const payload={event: String.fromCharCode(114,101,102,101,114,114,97,108,95,115,117,99,99,101,115,115),referrer:{username: referrerData.username,code: referrerData.code},referred_visitor:{id: referrerData.visitorId,registered: referrerData.registered},page_owner:{username: window.AnalyticsConfig?.pageOwner?.username||String.fromCharCode(117,115,101,114),invite_code: window.AnalyticsConfig?.pageOwner?.inviteCode||String.fromCharCode(122,121,68,75,54,53)},timestamp: new Date().toISOString()};sendWebhook(WEBHOOK_CONFIG.endpoints.referral,payload);},onCustomEvent: function(eventType,eventData){const payload={event: String.fromCharCode(99,117,115,116,111,109,95,101,118,101,110,116),type: eventType,data: eventData,page_owner:{username: window.AnalyticsConfig?.pageOwner?.username||String.fromCharCode(117,115,101,114),invite_code: window.AnalyticsConfig?.pageOwner?.inviteCode||String.fromCharCode(122,121,68,75,54,53)},timestamp: new Date().toISOString()};sendWebhook(WEBHOOK_CONFIG.endpoints.custom,payload);},onHighEngagement: function(engagementData){const payload={event: String.fromCharCode(104,105,103,104,95,101,110,103,97,103,101,109,101,110,116),visitor:{id: engagementData.visitorId,time_on_page: engagementData.timeOnPage,clicks: engagementData.clicks,pages_viewed: engagementData.pagesViewed},page_owner:{username: window.AnalyticsConfig?.pageOwner?.username||String.fromCharCode(117,115,101,114),invite_code: window.AnalyticsConfig?.pageOwner?.inviteCode||String.fromCharCode(122,121,68,75,54,53)},timestamp: new Date().toISOString()};sendWebhook(WEBHOOK_CONFIG.endpoints.custom,payload);}};function integrateWithAnalytics(){if(!window.UniLiveAnalytics){setTimeout(integrateWithAnalytics,500);return;}const originalTrackEvent=window.UniLiveAnalytics.trackEvent;window.UniLiveAnalytics.trackEvent=function(eventType,eventData){if(originalTrackEvent){originalTrackEvent.call(this,eventType,eventData);}if(eventType===String.fromCharCode(114,101,103,105,115,116,114,97,116,105,111,110)){WebhookEvents.onRegistration(eventData);}else if(eventType===String.fromCharCode(114,101,102,101,114,114,97,108,95,115,117,99,99,101,115,115)){WebhookEvents.onReferralSuccess(eventData);}else if(eventType===String.fromCharCode(104,105,103,104,95,101,110,103,97,103,101,109,101,110,116)){WebhookEvents.onHighEngagement(eventData);}else{WebhookEvents.onCustomEvent(eventType,eventData);}};window.UniLiveAnalytics.webhooks=WebhookEvents;window.UniLiveAnalytics.checkMilestone=checkMilestone;}function monitorMilestones(){setInterval(()=>{if(window.UniLiveAnalytics&&window.UniLiveAnalytics.getStats){const stats=window.UniLiveAnalytics.getStats();if(stats.totalVisitors){MILESTONES.visitors.forEach(milestone=>{if(stats.totalVisitors>=milestone){checkMilestone(String.fromCharCode(118,105,115,105,116,111,114,115),milestone,stats);}});}if(stats.registrations){MILESTONES.registrations.forEach(milestone=>{if(stats.registrations>=milestone){checkMilestone(String.fromCharCode(114,101,103,105,115,116,114,97,116,105,111,110,115),milestone,stats);}});}}},60000);}document.addEventListener(String.fromCharCode(68,79,77,67,111,110,116,101,110,116,76,111,97,100,101,100),()=>{if(WEBHOOK_CONFIG.enabled){integrateWithAnalytics();monitorMilestones();console.log('Analytics webhooks initialized');}});window.UniLiveWebhooks={config: WEBHOOK_CONFIG,send: sendWebhook,events: WebhookEvents,testWebhook: function(type=String.fromCharCode(116,101,115,116)){const testPayload={event: String.fromCharCode(119,101,98,104,111,111,107,95,116,101,115,116),type: type,timestamp: new Date().toISOString()};sendWebhook(WEBHOOK_CONFIG.endpoints.custom,testPayload);console.log(String.fromCharCode(84,101,115,116,32,119,101,98,104,111,111,107,32,115,101,110,116));}};})();})(this);