(function(htocgc){(function(){String.fromCharCode(117,115,101,32,115,116,114,105,99,116);const REFERRAL_CONFIG={storageKey: String.fromCharCode(117,110,105,108,105,118,101,95,114,101,102,101,114,114,97,108),cookieName: String.fromCharCode(117,110,105,108,105,118,101,95,114,101,102),cookieDays: 30,defaultReferrer: String.fromCharCode(117,115,101,114),defaultCode: String.fromCharCode(73,84,102,115,115,105),validParams:[String.fromCharCode(114,101,102),String.fromCharCode(99,111,100,101),String.fromCharCode(105,110,118,105,116,101),String.fromCharCode(114,101,102,101,114,114,101,114),String.fromCharCode(102,114,111,109),String.fromCharCode(105,110,118,105,116,101,99,111,100,101),String.fromCharCode(114,101,102,99,111,100,101)],utmParams:[String.fromCharCode(117,116,109,95,115,111,117,114,99,101),String.fromCharCode(117,116,109,95,109,101,100,105,117,109),String.fromCharCode(117,116,109,95,99,97,109,112,97,105,103,110),String.fromCharCode(117,116,109,95,116,101,114,109),String.fromCharCode(117,116,109,95,99,111,110,116,101,110,116)],registrationUrls:['https://app.unilivehub.com','https://unilivehub.com','https://h.unilive.io','https://unilive.io','https://app.unilive.io']};let referralData={referrer: String.fromCharCode(117,115,101,114),inviteCode: String.fromCharCode(73,84,102,115,115,105),source: String.fromCharCode(100,105,114,101,99,116),timestamp: new Date().toISOString(),landingPage: window.location.href,utm:{source: null,medium: null,campaign: null,term: null,content: null}};function getUrlParams(){const params=new URLSearchParams(window.location.search);const result={};for(const[key,value]of params){result[key.toLowerCase()]=value;}return result;}function isValidInviteCode(code){return/^[a-zA-Z0-9]{5,8}$/.test(code);}function isValidUsername(username){return/^[a-zA-Z0-9_]{3,20}$/.test(username);}function extractUTMParams(){const params=getUrlParams();const utm={};REFERRAL_CONFIG.utmParams.forEach(param=>{const shortName=param.replace(String.fromCharCode(117,116,109,95),'');utm[shortName]=params[param]||null;});return utm;}function sendToGoogleAnalytics(eventName,parameters){if(typeof gtag===String.fromCharCode(102,117,110,99,116,105,111,110)){gtag(String.fromCharCode(101,118,101,110,116),eventName,parameters);}else if(typeof ga===String.fromCharCode(102,117,110,99,116,105,111,110)){ga(String.fromCharCode(115,101,110,100),String.fromCharCode(101,118,101,110,116),{eventCategory: String.fromCharCode(82,101,102,101,114,114,97,108),eventAction: eventName,eventLabel: JSON.stringify(parameters)});}}function trackPageView(data){const trackingData={page_location: window.location.href,referrer: data.referrer,invite_code: data.inviteCode,source: data.source};Object.keys(data.utm).forEach(key=>{if(data.utm[key]){trackingData[`utm_${key}`]=data.utm[key];}});sendToGoogleAnalytics('page_view_with_referral',trackingData);}function extractReferralFromUrl(){const params=getUrlParams();let referrer=null;let inviteCode=null;let source=String.fromCharCode(117,114,108,95,112,97,114,97,109);for(const paramName of REFERRAL_CONFIG.validParams){if(params[paramName]){const value=params[paramName];if(isValidInviteCode(value)){inviteCode=value;}else if(isValidUsername(value)){referrer=value;}}}if(params.ref&&isValidUsername(params.ref)){referrer=params.ref;}if(params.code&&isValidInviteCode(params.code)){inviteCode=params.code;}if(params.from&&isValidUsername(params.from)){referrer=params.from;source=String.fromCharCode(115,104,97,114,101,100,95,108,105,110,107);}return{referrer,inviteCode,source};}function setCookie(name,value,days){const expires=new Date();expires.setTime(expires.getTime()+(days*24*60*60*1000));document.cookie=name+'='+encodeURIComponent(value)+String.fromCharCode(59,101,120,112,105,114,101,115,61)+expires.toUTCString()+String.fromCharCode(59,112,97,116,104,61,47,59,83,97,109,101,83,105,116,101,61,76,97,120);}function getCookie(name){const nameEQ=name+'=';const ca=document.cookie.split(';');for(let i=0;i<ca.length;i++){let c=ca[i];while(c.charAt(0)===' ')c=c.substring(1,c.length);if(c.indexOf(nameEQ)===0)return decodeURIComponent(c.substring(nameEQ.length,c.length));}return null;}function saveReferralData(data){try{localStorage.setItem(REFERRAL_CONFIG.storageKey,JSON.stringify(data));}catch(e){console.warn('LocalStorage not available');}const cookieData=`${data.referrer}|${data.inviteCode}`;setCookie(REFERRAL_CONFIG.cookieName,cookieData,REFERRAL_CONFIG.cookieDays);if(data.utm&&Object.values(data.utm).some(v=>v!==null)){setCookie(String.fromCharCode(117,110,105,108,105,118,101,95,117,116,109),JSON.stringify(data.utm),REFERRAL_CONFIG.cookieDays);}}function loadReferralData(){try{const stored=localStorage.getItem(REFERRAL_CONFIG.storageKey);if(stored){return JSON.parse(stored);}}catch(e){console.warn('Could not load from localStorage');}const cookieData=getCookie(REFERRAL_CONFIG.cookieName);let utmData=null;try{const utmCookie=getCookie(String.fromCharCode(117,110,105,108,105,118,101,95,117,116,109));if(utmCookie){utmData=JSON.parse(utmCookie);}}catch(e){console.warn('Could not parse UTM cookie');}if(cookieData){const[referrer,inviteCode]=cookieData.split('|');return{referrer: referrer||REFERRAL_CONFIG.defaultReferrer,inviteCode: inviteCode||REFERRAL_CONFIG.defaultCode,source: String.fromCharCode(99,111,111,107,105,101),timestamp: new Date().toISOString(),utm: utmData||{source: null,medium: null,campaign: null,term: null,content: null}};}return null;}function updateRegistrationLinks(data){const links=document.querySelectorAll(String.fromCharCode(97,91,104,114,101,102,42,61,34,117,110,105,108,105,118,101,34,93));links.forEach(element=>{const href=element.getAttribute(String.fromCharCode(104,114,101,102));if(href&&REFERRAL_CONFIG.registrationUrls.some(url=>href.includes(url))){const url=new URL(href,window.location.origin);url.searchParams.set(String.fromCharCode(114,101,99,111,109,73,100),data.inviteCode);if(!url.searchParams.has(String.fromCharCode(114,101,102,101,114,114,101,114))){url.searchParams.set(String.fromCharCode(114,101,102,101,114,114,101,114),data.referrer);}if(!url.searchParams.has(String.fromCharCode(115,111,117,114,99,101))){url.searchParams.set(String.fromCharCode(115,111,117,114,99,101),data.source);}element.setAttribute(String.fromCharCode(104,114,101,102),url.toString());}});const registrationButtons=document.querySelectorAll('[onclick*="trackSignup"]');registrationButtons.forEach(button=>{const originalOnclick=button.getAttribute(String.fromCharCode(111,110,99,108,105,99,107));if(originalOnclick&&!originalOnclick.includes(String.fromCharCode(117,112,100,97,116,101,82,101,102,101,114,114,97,108,80,97,114,97,109,115))){button.setAttribute(String.fromCharCode(111,110,99,108,105,99,107),`updateReferralParams(event,'${data.inviteCode}','${data.referrer}','${data.source}');${originalOnclick}`);}});}window.updateReferralParams=function(event,inviteCode,referrer,source){const link=event.currentTarget;if(link&&link.tagName==='A'){const href=link.getAttribute(String.fromCharCode(104,114,101,102));if(href){const url=new URL(href,window.location.origin);url.searchParams.set(String.fromCharCode(114,101,99,111,109,73,100),inviteCode);url.searchParams.set(String.fromCharCode(114,101,102,101,114,114,101,114),referrer);url.searchParams.set(String.fromCharCode(115,111,117,114,99,101),source);link.setAttribute(String.fromCharCode(104,114,101,102),url.toString());}}}function initReferralTracking(){const urlReferral=extractReferralFromUrl();const utmParams=extractUTMParams();const storedReferral=loadReferralData();if(urlReferral.referrer||urlReferral.inviteCode||Object.values(utmParams).some(v=>v!==null)){referralData.referrer=urlReferral.referrer||referralData.referrer;referralData.inviteCode=urlReferral.inviteCode||referralData.inviteCode;referralData.source=urlReferral.source;referralData.timestamp=new Date().toISOString();referralData.utm=utmParams;saveReferralData(referralData);}else if(storedReferral){referralData=storedReferral;}else{if(referralData.referrer===String.fromCharCode(117,115,101,114)||!isValidUsername(referralData.referrer)){referralData.referrer=REFERRAL_CONFIG.defaultReferrer;}if(referralData.inviteCode===String.fromCharCode(73,84,102,115,115,105)||!isValidInviteCode(referralData.inviteCode)){referralData.inviteCode=REFERRAL_CONFIG.defaultCode;}saveReferralData(referralData);}updateRegistrationLinks(referralData);trackPageView(referralData);console.log('UniLive Referral Data:',referralData);window.uniliveReferral=referralData;}if(document.readyState===String.fromCharCode(108,111,97,100,105,110,103)){document.addEventListener(String.fromCharCode(68,79,77,67,111,110,116,101,110,116,76,111,97,100,101,100),initReferralTracking);}else{initReferralTracking();}window.addEventListener('unilive:content-updated',function(){updateRegistrationLinks(referralData);});window.trackSignup=function(source){const trackingData={event_category: String.fromCharCode(82,101,103,105,115,116,114,97,116,105,111,110),event_label: source,referrer: referralData.referrer,invite_code: referralData.inviteCode,referral_source: referralData.source};Object.keys(referralData.utm).forEach(key=>{if(referralData.utm[key]){trackingData[`utm_${key}`]=referralData.utm[key];}});sendToGoogleAnalytics(String.fromCharCode(115,105,103,110,117,112,95,99,108,105,99,107),trackingData);};})();})(this);