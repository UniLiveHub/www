(function(ipvnwb){(function(){String.fromCharCode(117,115,101,32,115,116,114,105,99,116);const config=window.AnalyticsConfig;if(!config){console.error('Analytics configuration not found');return;}let analyticsData={recordId: null,visitorId: getVisitorId(),sessionId: generateSessionId(),startTime: Date.now(),clicks: 0,events:[],lastUpdate: Date.now()};function getVisitorId(){let visitorId=localStorage.getItem(String.fromCharCode(117,110,105,108,105,118,101,95,118,105,115,105,116,111,114,95,105,100));if(!visitorId){visitorId='v_'+Math.random().toString(36).substr(2,9)+Date.now();localStorage.setItem(String.fromCharCode(117,110,105,108,105,118,101,95,118,105,115,105,116,111,114,95,105,100),visitorId);}return visitorId;}function generateSessionId(){return 's_'+Math.random().toString(36).substr(2,9)+Date.now();}function getDeviceInfo(){const ua=navigator.userAgent;const mobile=/Mobile|Android|iPhone|iPad/i.test(ua);const tablet=/iPad|Android(?!.*Mobile)/i.test(ua);return{deviceType: tablet ? String.fromCharCode(116,97,98,108,101,116) : mobile ? String.fromCharCode(109,111,98,105,108,101) : String.fromCharCode(100,101,115,107,116,111,112),userAgent: ua,screenWidth: window.screen.width,screenHeight: window.screen.height,language: navigator.language||'en'};}function getReferralInfo(){const stored=JSON.parse(localStorage.getItem(String.fromCharCode(117,110,105,108,105,118,101,95,114,101,102,101,114,114,97,108))||'{}');const urlParams=new URLSearchParams(window.location.search);return{referralSource: stored.referrer||urlParams.get(String.fromCharCode(114,101,102))||null,referralCode: stored.code||urlParams.get(String.fromCharCode(99,111,100,101))||null,referralType: stored.referrer ? String.fromCharCode(114,101,102,101,114,114,97,108) : String.fromCharCode(111,114,103,97,110,105,99),utmSource: urlParams.get(String.fromCharCode(117,116,109,95,115,111,117,114,99,101))||null,utmMedium: urlParams.get(String.fromCharCode(117,116,109,95,109,101,100,105,117,109))||null,utmCampaign: urlParams.get(String.fromCharCode(117,116,109,95,99,97,109,112,97,105,103,110))||null,utmTerm: urlParams.get(String.fromCharCode(117,116,109,95,116,101,114,109))||null,utmContent: urlParams.get(String.fromCharCode(117,116,109,95,99,111,110,116,101,110,116))||null};}function mapFields(data){const mapping=config.fieldMappings[config.backend];if(!mapping){console.error('No field mapping for backend:',config.backend);return data;}const mapped={};for(const[key,value]of Object.entries(data)){if(mapping[key]){mapped[mapping[key]]=value;}else{mapped[key]=value;}}return mapped;}async function sendToBackend(data,isUpdate=false){const backend=config.backend;const endpoint=config.endpoints[backend];if(!endpoint||!endpoint.url||endpoint.url.includes('%')){if(config.options.debug){console.log('Analytics backend not configured');}return;}const mappedData=mapFields(data);try{let response;switch(backend){case String.fromCharCode(115,117,112,97,98,97,115,101): response=await sendToSupabase(mappedData,isUpdate);break;case String.fromCharCode(110,101,115,116,106,115): response=await sendToNestJS(mappedData,isUpdate);break;case String.fromCharCode(108,97,114,97,118,101,108): response=await sendToLaravel(mappedData,isUpdate);break;case String.fromCharCode(99,117,115,116,111,109): response=await sendToCustom(mappedData,isUpdate);break;default: console.error(String.fromCharCode(85,110,107,110,111,119,110,32,98,97,99,107,101,110,100,58),backend);return;}if(response&&response.id&&!analyticsData.recordId){analyticsData.recordId=response.id;}return response;}catch(error){if(config.options.debug){console.error(String.fromCharCode(65,110,97,108,121,116,105,99,115,32,101,114,114,111,114,58),error);}if(config.options.maxRetries>0){setTimeout(()=>{config.options.maxRetries--;sendToBackend(data,isUpdate);},config.options.retryDelay);}}}async function sendToSupabase(data,isUpdate){const endpoint=config.endpoints.supabase;const url=isUpdate&&analyticsData.recordId ? `${endpoint.url}/rest/v1/${endpoint.table}?id=eq.${analyticsData.recordId}` : `${endpoint.url}/rest/v1/${endpoint.table}`;const response=await fetch(url,{method: isUpdate ? String.fromCharCode(80,65,84,67,72) : String.fromCharCode(80,79,83,84),headers:{String.fromCharCode(67,111,110,116,101,110,116,45,84,121,112,101): String.fromCharCode(97,112,112,108,105,99,97,116,105,111,110,47,106,115,111,110),String.fromCharCode(97,112,105,107,101,121): endpoint.anonKey,String.fromCharCode(65,117,116,104,111,114,105,122,97,116,105,111,110): `Bearer ${endpoint.anonKey}`,String.fromCharCode(80,114,101,102,101,114): 'return=representation'},body: JSON.stringify(data)});if(!response.ok)throw new Error(`Supabase error: ${response.status}`);return isUpdate ? null : await response.json();}async function sendToNestJS(data,isUpdate){const endpoint=config.endpoints.nestjs;const url=isUpdate&&analyticsData.recordId ? `${endpoint.url}${endpoint.analyticsEndpoint}/${analyticsData.recordId}` : `${endpoint.url}${endpoint.analyticsEndpoint}`;const response=await fetch(url,{method: isUpdate ? String.fromCharCode(80,85,84) : String.fromCharCode(80,79,83,84),headers:{String.fromCharCode(67,111,110,116,101,110,116,45,84,121,112,101): String.fromCharCode(97,112,112,108,105,99,97,116,105,111,110,47,106,115,111,110),String.fromCharCode(65,117,116,104,111,114,105,122,97,116,105,111,110): `Bearer ${endpoint.apiKey}`,String.fromCharCode(88,45,65,80,73,45,75,101,121): endpoint.apiKey},body: JSON.stringify(data)});if(!response.ok)throw new Error(`NestJS error: ${response.status}`);return await response.json();}async function sendToLaravel(data,isUpdate){const endpoint=config.endpoints.laravel;const url=isUpdate&&analyticsData.recordId ? `${endpoint.url}${endpoint.analyticsEndpoint}/${analyticsData.recordId}` : `${endpoint.url}${endpoint.analyticsEndpoint}`;const response=await fetch(url,{method: isUpdate ? String.fromCharCode(80,85,84) : String.fromCharCode(80,79,83,84),headers:{String.fromCharCode(67,111,110,116,101,110,116,45,84,121,112,101): String.fromCharCode(97,112,112,108,105,99,97,116,105,111,110,47,106,115,111,110),String.fromCharCode(65,117,116,104,111,114,105,122,97,116,105,111,110): `Bearer ${endpoint.apiKey}`,String.fromCharCode(65,99,99,101,112,116): String.fromCharCode(97,112,112,108,105,99,97,116,105,111,110,47,106,115,111,110),String.fromCharCode(88,45,67,83,82,70,45,84,79,75,69,78): document.querySelector('meta[name="csrf-token"]')?.content||''},body: JSON.stringify(data)});if(!response.ok)throw new Error(`Laravel error: ${response.status}`);return await response.json();}async function sendToCustom(data,isUpdate){const endpoint=config.endpoints.custom;const url=isUpdate&&analyticsData.recordId ? `${endpoint.url}${endpoint.analyticsEndpoint}/${analyticsData.recordId}` : `${endpoint.url}${endpoint.analyticsEndpoint}`;const response=await fetch(url,{method: isUpdate ? String.fromCharCode(80,85,84) : String.fromCharCode(80,79,83,84),headers:{String.fromCharCode(67,111,110,116,101,110,116,45,84,121,112,101): String.fromCharCode(97,112,112,108,105,99,97,116,105,111,110,47,106,115,111,110),String.fromCharCode(65,117,116,104,111,114,105,122,97,116,105,111,110): `Bearer ${endpoint.apiKey}`},body: JSON.stringify(data)});if(!response.ok)throw new Error(`Custom API error: ${response.status}`);return await response.json();}function trackPageView(){if(!config.options.trackPageViews)return;const deviceInfo=getDeviceInfo();const referralInfo=getReferralInfo();const data={visitorId: analyticsData.visitorId,sessionId: analyticsData.sessionId,pageOwnerUsername: config.pageOwner.username,pageOwnerInviteCode: config.pageOwner.inviteCode,pageUrl: window.location.href,referrerUrl: document.referrer||null,...referralInfo,...deviceInfo,timeOnPage: 0,clicksCount: 0,ctaClicked: false,registered: false};sendToBackend(data,false);if(config.options.trackTimeOnPage){setInterval(updateTimeOnPage,config.options.timeOnPageInterval);}}function updateTimeOnPage(){if(!analyticsData.recordId)return;const timeOnPage=Math.floor((Date.now()-analyticsData.startTime)/1000);sendToBackend({timeOnPage: timeOnPage,clicksCount: analyticsData.clicks},true);}function trackClick(event){if(!config.options.trackClicks)return;analyticsData.clicks++;const target=event.target;const isCtaButton=target.classList.contains(String.fromCharCode(99,116,97,45,98,117,116,116,111,110))||target.closest('.cta-button')||target.href?.includes('app.unilivehub.com');if(isCtaButton&&analyticsData.recordId){sendToBackend({ctaClicked: true,clicksCount: analyticsData.clicks},true);}}function trackRegistration(){if(!config.options.trackRegistrations||!analyticsData.recordId)return;sendToBackend({registered: true},true);}function sendFinalUpdate(){if(!analyticsData.recordId)return;const timeOnPage=Math.floor((Date.now()-analyticsData.startTime)/1000);const data=mapFields({timeOnPage: timeOnPage,clicksCount: analyticsData.clicks});const endpoint=config.endpoints[config.backend];if(endpoint&&navigator.sendBeacon){const beaconData=new Blob([JSON.stringify(data)],{type: String.fromCharCode(97,112,112,108,105,99,97,116,105,111,110,47,106,115,111,110)});navigator.sendBeacon(`${endpoint.url}${endpoint.analyticsEndpoint||String.fromCharCode(47,97,110,97,108,121,116,105,99,115)}/${analyticsData.recordId}`,beaconData);}}document.addEventListener(String.fromCharCode(68,79,77,67,111,110,116,101,110,116,76,111,97,100,101,100),()=>{trackPageView();document.addEventListener(String.fromCharCode(99,108,105,99,107),trackClick);document.querySelectorAll('a[href*="app.unilivehub.com"]').forEach(link=>{link.addEventListener(String.fromCharCode(99,108,105,99,107),trackRegistration);});});window.addEventListener(String.fromCharCode(98,101,102,111,114,101,117,110,108,111,97,100),sendFinalUpdate);let engagementTimer=null;function checkHighEngagement(){const timeOnPage=Math.floor((Date.now()-analyticsData.startTime)/1000);if((timeOnPage>120||analyticsData.clicks>10)&&!analyticsData.highEngagementTracked){analyticsData.highEngagementTracked=true;if(window.UniLiveAnalytics&&window.UniLiveAnalytics.trackEvent){window.UniLiveAnalytics.trackEvent(String.fromCharCode(104,105,103,104,95,101,110,103,97,103,101,109,101,110,116),{visitorId: analyticsData.visitorId,timeOnPage: timeOnPage,clicks: analyticsData.clicks,pagesViewed: 1});}}}engagementTimer=setInterval(checkHighEngagement,30000);window.UniLiveAnalytics={trackEvent: function(eventType,eventData){const data={visitorAnalyticsId: analyticsData.recordId,eventType: eventType,eventData: eventData,timestamp: new Date().toISOString()};sendToBackend(data,false);if(eventType===String.fromCharCode(114,101,103,105,115,116,114,97,116,105,111,110)&&!eventData){eventData={visitorId: analyticsData.visitorId,sessionId: analyticsData.sessionId,deviceType: getDeviceInfo().deviceType,referralSource: getReferralInfo().referralSource,utmSource: getReferralInfo().utmSource,utmCampaign: getReferralInfo().utmCampaign};}},getVisitorId:()=>analyticsData.visitorId,getSessionId:()=>analyticsData.sessionId,getRecordId:()=>analyticsData.recordId,updateField:(field,value)=>{if(analyticsData.recordId){const data={};data[field]=value;sendToBackend(data,true);}},getStats:()=>{return{totalVisitors: 1,registrations: analyticsData.registered ? 1 : 0,currentSession:{timeOnPage: Math.floor((Date.now()-analyticsData.startTime)/1000),clicks: analyticsData.clicks,ctaClicked: analyticsData.ctaClicked}};}};})();})(this);